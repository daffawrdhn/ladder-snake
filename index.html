<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ladder Snake - Premium Multiplayer</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <div class="app-container">
        <!-- Login Screen -->
        <section id="login-screen" class="screen active">
            <div class="login-wrapper">
                <div class="floating-icons">
                    <span class="float-icon">ğŸ</span>
                    <span class="float-icon">ğŸªœ</span>
                    <span class="float-icon">ğŸ²</span>
                    <span class="float-icon">ğŸ†</span>
                    <span class="float-icon">â­</span>
                </div>
                <div class="glass-card login-card">
                    <div class="game-logo">ğŸğŸªœ</div>
                    <h1>Ladder Snake</h1>
                    <p class="subtitle">Roll the dice. Climb the ladder. Avoid the snake!</p>
                    <form id="login-form">
                        <input type="text" id="nickname" placeholder="ğŸ® Enter your nickname" maxlength="12" required>
                        <button type="submit" class="btn-primary">ğŸš€ Enter Lobby</button>
                    </form>
                    <div class="login-footer">
                        <span>ğŸ¯ Up to 8 players</span>
                        <span>âš¡ Real-time multiplayer</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lobby Screen -->
        <section id="lobby-screen" class="screen">
            <div class="glass-panel">
                <header>
                    <h2>Lobby</h2>
                    <div class="user-info">
                        Playing as
                        <span id="nickname-display">
                            <span id="my-nickname">Guest</span>
                            <button id="edit-nickname-btn" class="btn-icon" title="Change name">âœï¸</button>
                        </span>
                        <span id="nickname-edit" class="hidden">
                            <input type="text" id="new-nickname" maxlength="12" placeholder="New name">
                            <button id="save-nickname-btn" class="btn-icon-small">âœ“</button>
                            <button id="cancel-nickname-btn" class="btn-icon-small">âœ•</button>
                        </span>
                    </div>
                </header>

                <div class="lobby-content">
                    <div class="player-list-container">
                        <h3>Online Players</h3>
                        <p class="hint">Select players to start a game (Max 7 opponents)</p>
                        <ul id="online-players-list">
                            <!-- Players injected here -->
                        </ul>
                    </div>

                    <!-- Invite Status Panel (for host) -->
                    <div id="invite-status-panel" class="invite-status-panel hidden">
                        <h3>ğŸ“¨ Invite Status</h3>
                        <ul id="invite-status-list">
                            <!-- Invite statuses injected here -->
                        </ul>
                        <div class="invite-actions">
                            <button id="start-with-accepted-btn" class="btn-primary" disabled>Start Game</button>
                            <button id="cancel-invite-btn" class="btn-secondary">Cancel</button>
                        </div>
                    </div>
                </div>

                <footer>
                    <button id="create-game-btn" class="btn-primary" disabled>Send Invite</button>
                </footer>
            </div>

            <!-- Invite Popup (for invited players) -->
            <div id="invite-popup" class="invite-popup hidden">
                <div class="invite-popup-content">
                    <h3>ğŸ® Game Invite!</h3>
                    <p><span id="invite-host-name">Player</span> wants to play with you!</p>
                    <div class="invite-popup-actions">
                        <button id="accept-invite-btn" class="btn-primary">Accept</button>
                        <button id="decline-invite-btn" class="btn-secondary">Decline</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Game Screen -->
        <section id="game-screen" class="screen">
            <!-- Sticky Header -->
            <header class="game-header">
                <div class="header-left">
                    <span class="timer-label">Chaos</span>
                    <div id="chaos-timer" class="timer-value">60s</div>
                </div>
                <div class="header-center">
                    <div class="game-brand">ğŸğŸªœ</div>
                </div>
                <div class="header-right">
                    <span class="timer-label">Turn</span>
                    <div id="turn-timer" class="timer-value badge-warning">--</div>
                </div>
            </header>

            <!-- Main Scrollable Board Area -->
            <main class="game-main">
                <div class="board-wrapper">
                    <div id="board" class="game-board">
                        <!-- 100 Cells generated by JS -->
                    </div>
                    <canvas id="board-overlay"></canvas>
                </div>
            </main>

            <!-- Sticky Footer Controls -->
            <footer class="game-footer">
                <button id="toggle-players-btn" class="footer-btn">
                    ğŸ‘¥ <span class="btn-label">Players</span>
                </button>

                <div class="footer-center">
                    <!-- Dice Control Card -->
                    <div id="dice-control" class="dice-card">
                        <div id="turn-indicator" class="turn-status">Waiting...</div>
                        <div class="dice-display">
                            <div id="dice" class="dice-number">1</div>
                        </div>
                        <button id="roll-btn" class="roll-button" disabled>
                            <span class="roll-icon">ğŸ²</span>
                            <span class="roll-text">ROLL</span>
                        </button>
                    </div>
                </div>

                <button id="toggle-log-btn" class="footer-btn">
                    ğŸ“‹ <span class="btn-label">Log</span>
                </button>
            </footer>

            <!-- Modals/Popups for Mobile (Bottom Sheets) -->
            <div id="players-sheet" class="bottom-sheet hidden">
                <div class="sheet-header">
                    <h3>Players</h3>
                    <button class="close-sheet">âœ•</button>
                </div>
                <div class="sheet-content">
                    <ul id="game-player-list"></ul>
                </div>
            </div>

            <div id="log-sheet" class="bottom-sheet hidden">
                <div class="sheet-header">
                    <h3>Game Log</h3>
                    <button class="close-sheet">âœ•</button>
                </div>
                <div class="sheet-content">
                    <div id="game-log"></div>
                </div>
            </div>

            <div id="sheet-overlay" class="sheet-overlay hidden"></div>
        </section>
    </div>

    <!-- Winner Modal -->
    <div id="winner-modal" class="winner-modal hidden">
        <div id="confetti-container"></div>
        <div class="winner-content">
            <div class="trophy">ğŸ†</div>
            <h1 class="winner-title">VICTORY!</h1>
            <p class="winner-name" id="winner-name">Player Name</p>
            <p class="winner-subtitle">has conquered the board!</p>
            <div class="winner-stars">â­ â­ â­</div>
            <button class="btn-primary" onclick="backToLobby()">Play Again</button>
        </div>
    </div>

    <!-- Loser Modal -->
    <div id="loser-modal" class="loser-modal hidden">
        <div class="loser-content">
            <div class="loser-emoji">ğŸ˜¢</div>
            <h1 class="loser-title">GAME OVER</h1>
            <p class="loser-text"><span id="loser-winner-name">Player</span> wins!</p>
            <p class="loser-subtitle">Better luck next time!</p>
            <button class="btn-primary" onclick="backToLobby()">Back to Lobby</button>
        </div>
    </div>

    <!-- Disconnect Modal -->
    <div id="disconnect-modal" class="loser-modal hidden">
        <div class="loser-content">
            <div class="loser-emoji">ğŸ”Œ</div>
            <h1 class="loser-title">PLAYER LEFT</h1>
            <p class="loser-text"><span id="disconnect-player-name">A player</span> disconnected</p>
            <p class="loser-subtitle">The game has ended</p>
            <button class="btn-primary" onclick="backToLobby()">Back to Lobby</button>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notifications"></div>

    <!-- JS Modules (order matters!) -->
    <script src="js/core.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/lobby.js"></script>
    <script src="js/game.js"></script>
    <script src="js/modals.js"></script>
    <script src="js/invite.js"></script>
    <script src="js/socket-handler.js"></script>
</body>

</html>